<% title t('.page_title') %>

<turbo-frame id="disbursements">
  <h3 class="govuk-heading-m">
    <%= t('.disbursements') %>
  </h3>

  <% if @disbursements.size.zero? %>
    <p><%= t('.no_data') %></p>
  <% else %>
    <%
      pagy, disbursements = pagy(@disbursements)
      head = [
        { text: t('.line_item')},
        { text: t('.item'), width: 'govuk-!-width-one-quarter' },
        { text: t('.date')},
        { text: t('.net_cost'), numeric: true },
        { text: t('.vat'), numeric: true },
        { text: t('.gross_cost'), numeric: true },
      ]
    %>

    <%=
      rows = disbursements.each_with_index.map do |disbursement, index|

        link = link_to(disbursement.record.translated_disbursement_type, item_nsm_steps_view_claim_path(id: current_application.id, item_type: :disbursement, item_id: disbursement.record.id, page: pagy.page), data: { turbo: 'false' })

        [
          { header: true, text: index + 1, numeric: false},
          { header: true, text: link, numeric: false},
          { text: disbursement.disbursement_date&.strftime("%-d %b %Y"), numeric: false },
          { text: NumberTo.pounds(disbursement.total_cost_without_vat), numeric: true },
          { text: NumberTo.pounds(disbursement.vat), numeric: true },
          { text: NumberTo.pounds(disbursement.total_cost), numeric: true },
        ]
      end

      govuk_table_with_cell(head, rows)
    %>
  <% end %>
  <%= render "shared/pagination",  { pagy: pagy, item: t('.table_info_item') } %>
</turbo-frame>
